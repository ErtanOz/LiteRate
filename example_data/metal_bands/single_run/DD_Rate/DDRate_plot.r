library('ggplot2')
library('gridExtra')

time=c(0.0, 1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,11.0,12.0,13.0,14.0,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.0,29.0,30.0,31.0)
net_diversity=c(1.0, 2.0,5.0,8.0,13.0,14.0,16.5,20.0,25.0,36.0,52.5,84.5,145.0,266.5,455.5,758.5,1130.0,1525.5,1937.0,2517.0,3081.5,3688.0,4345.5,5063.0,5889.5,6689.5,7471.5,8269.5,9044.0,9883.5,10914.0,12074.5)
emp_birth=c(NA, 0.5,0.6,0.375,0.38461538461538464,0.07142857142857142,0.18181818181818182,0.2,0.2,0.3055555555555556,0.3238095238095238,0.41420118343195267,0.4689655172413793,0.5290806754221389,0.5268935236004391,0.5234014502307185,0.46814159292035395,0.429367420517863,0.3939081053175013,0.4028605482717521,0.355346422196982,0.34029284164859,0.330456794384996,0.32016590953979857,0.33041854147211136,0.31123402346961654,0.28548484240112426,0.27474454320091907,0.25375939849624063,0.23534173116810847,0.2278724573941726,0.21955360470412855)
emp_death=c(NA, 0.0,0.0,0.0,0.0,0.0,0.06060606060606061,0.0,0.0,0.0,0.01904761904761905,0.05917159763313609,0.06896551724137931,0.10881801125703565,0.1602634467618002,0.15161502966381016,0.17699115044247787,0.20911176663389053,0.1982447083118224,0.19229241160111243,0.18724647087457408,0.19522776572668113,0.19261304798066967,0.19158601619593127,0.2154682061295526,0.19358696464608716,0.18831559927725355,0.1863474212467501,0.16585581601061478,0.14903627257550464,0.1319406267179769,0.1276243322704874)
birth_rate=c(0.5359504470537166, 0.48322873699708613,0.40368486393144515,0.3579322975841618,0.3067648661847743,0.29911870210977987,0.2789972600319799,0.2605707722161597,0.2547046352281632,0.2669251238724347,0.33025293976756387,0.42390438312510903,0.5009378136942132,0.5294957797090298,0.5220402067660577,0.49309597874417505,0.4634415242407479,0.4382860358263306,0.4173650785712485,0.39295955056229864,0.37307942917855696,0.35558655343591183,0.33914344773158955,0.32280871859799026,0.3060570895107993,0.2914717713637868,0.2784954873429646,0.2665545195551521,0.2559293808314195,0.24500280153791248,0.2327230748365611,0.2203635518590035)
birth_minHPD=c(0.46130649916, 0.40719388952299995,0.304752864828,0.254557157341,0.196083975787,0.185204710064,0.167785021278,0.153462910044,0.16097452302100002,0.18384241343899999,0.222416532751,0.33244925136500003,0.432423182693,0.489141897042,0.49452457308700004,0.470151799227,0.44787145594899996,0.42572885981299996,0.40662091547,0.385161398029,0.366995048957,0.349736668407,0.333461778016,0.317664944215,0.301505117284,0.287346393425,0.274625501025,0.26265255119500003,0.251985776866,0.241513492076,0.228224038699,0.215146726122)
birth_maxHPD=c(0.618521297015, 0.5714819760800001,0.491803715212,0.459131588769,0.414129936972,0.404916435728,0.388373471172,0.365834816208,0.346415025044,0.366937702698,0.437418360926,0.5329028343500001,0.570101614627,0.574704366495,0.552404213338,0.515902669867,0.481832337653,0.45247292779200005,0.427938841668,0.401990698164,0.38121888902900003,0.362442597756,0.344829799619,0.328163337103,0.311063068389,0.296132997374,0.282617308309,0.269958359332,0.259086761282,0.249000623692,0.23691949584600003,0.226099903037)
death_rate=c(0.16888043152841178, 0.168880606272025,0.16888502153234167,0.16890529236845625,0.1690276762711493,0.16906319614349444,0.16920038030609028,0.16935335097581874,0.1693304035854257,0.1691954811458403,0.16895454637626042,0.16888427430136457,0.16888052846967222,0.16888043284764095,0.16888042944060902,0.16888046135778959,0.1688805675934118,0.1688808161229132,0.16888128660551943,0.16888251088875,0.16888461363789445,0.16888804860867224,0.1688936603988868,0.168903090067216,0.1689193897467764,0.16894239944405764,0.16897353921407984,0.16901522985647915,0.16906711491695903,0.16914047265406598,0.16925630621971183,0.16942275289859932)
death_minHPD=c(0.166238553697, 0.166238558241,0.166238758508,0.166239956795,0.166137559043,0.166066593987,0.166483563557,0.166299598072,0.16639027672599999,0.16664761968,0.166052919535,0.166278751864,0.16623855486199998,0.16623855350800001,0.166238553762,0.166238556085,0.16623856717,0.166238600855,0.166279846955,0.166282337104,0.16628646386499998,0.166292959982,0.16629895701199998,0.166301844608,0.166234878678,0.16625762808800001,0.166249470007,0.166414380547,0.166517809388,0.166584069546,0.166813514306,0.166952142072)
death_maxHPD=c(0.171533229133, 0.171533229154,0.17153323028499998,0.17153323793699998,0.17158721135000002,0.17159095457100002,0.172263367696,0.17240968083799998,0.172326600398,0.17222812340500002,0.171419083449,0.17157581169599997,0.17153322914900002,0.171533229146,0.17153322925,0.17153323022199998,0.171533235334,0.171533252104,0.1715744593,0.171576357644,0.171579535121,0.171584577824,0.171592557948,0.17160550033500002,0.171549541698,0.171568530234,0.17158551367,0.17174293799,0.17184614973499998,0.171910637364,0.17213598728,0.172300676757)
niche=c(153.2806394467072, 153.28586464213674,153.300926267617,153.34599514498194,153.48678544086806,153.94857685680762,155.5481854081697,161.43709016363547,184.67582279563996,284.51498220059705,777.8271103957687,3714.459097488727,14634.95995805681,33746.587786516524,48816.935415283675,55211.893504211745,57195.23405262528,57755.814975851805,57914.17595088722,57960.27324466147,57974.21821121028,57978.60578823056,57980.038579617634,57980.52260369104,57980.691128962084,57980.75137788916,57980.77341605596,57980.781637312015,57980.78475617993,57980.78595644473,57980.786424038335,57980.78660811417)
niche_minHPD=c(25.0150673756, 25.019809214899997,25.0397651748,25.1237493811,25.4771923002,26.964589328899997,33.2231642502,50.4803822443,67.36004347689999,107.60558163200001,185.81150662299999,560.756714175,4022.82983516,14123.8383099,28617.2934749,37670.6465417,38136.2544023,38267.043663,38244.5848096,38247.5029601,38248.0447674,38248.1453563,38248.164030800006,38248.1674977,38248.168141400005,38248.168260900005,38248.168283,38248.168287199995,38248.1682879,38248.1682881,38248.1682881,38248.1682881)
niche_maxHPD=c(335.372574034, 335.37854277400004,335.40060403900003,335.482145349,335.783531463,336.89747314,341.01444822900004,358.018203751,371.66367509599996,554.4831693919999,1636.35934707,8671.67378107,36550.1386318,53452.3269823,67357.4980453,74378.5970433,77280.69188130001,78631.0049719,78696.9677661,78843.4372513,78866.78633660001,78873.0311555,78874.7009003,78875.1473252,78875.2666795,78875.29858939999,78875.3071206,78875.3094015,78875.3100113,78875.3101743,78875.31021789998,78875.3102295)

rates.dat<-data.frame(time,net_diversity,emp_birth,emp_death,birth_rate,birth_minHPD,birth_maxHPD,death_rate,death_minHPD,death_maxHPD,niche,niche_minHPD,niche_maxHPD)

rate_plot<-ggplot(rates.dat, aes(time,birth_rate)) +
    geom_line(size=.7,col='blue') +
    geom_line(aes(time,death_rate),col='red',size=.7) +
     scale_color_manual(values = c('blue','red')) +
    scale_x_continuous(breaks=seq(1968.0,2000.5,5),minor_breaks=seq(1968.0,2000.5,1)) +
    scale_y_continuous(breaks=seq(0.0,0.6000000000000001,.1),limits = c(0.0,0.6000000000000001)) + 
    geom_ribbon(aes_string(ymin=birth_minHPD,ymax=birth_maxHPD,fill=shQuote('red')),alpha=.2,col=NA)+ 
    geom_ribbon(aes_string(ymin=death_minHPD,ymax=death_maxHPD,fill=shQuote('blue')),alpha=.2,col=NA)+
    geom_line(aes(time,emp_birth,col='eb'),size=.5,linetype = 'dashed')+
    geom_line(aes(time,emp_death,col='ed'),size=.5,linetype = 'dashed')+
    theme(legend.position = 'none')+
    labs(x='Time',y='Rates')


div_plot<-ggplot(rates.dat,aes(time,net_diversity))+
      geom_line(aes(time,net_diversity,col='Net Diversity'),col='dark green',size=.5,linetype = 'dashed')+
      geom_line(aes(time,niche,col='Carrying Capacity'),size=.5) +
      scale_x_continuous(breaks=seq(1968.0,2000.5,5),minor_breaks=seq(1968.0,2000.5,1)) +
      geom_ribbon(aes(ymin=niche_minHPD,ymax=niche_maxHPD,fill='Carrying Capacity'),alpha=.30,col=NA) +
      theme(legend.position = 'none')+
      labs(x='Time',y='Number of Lineages')
fig<-grid.arrange(rate_plot,div_plot,nrow = 2,ncol=1)
ggsave(file='example_data/metal_bands/single_run/DD_Rate/DDRate_plot.pdf', plot=fig)
