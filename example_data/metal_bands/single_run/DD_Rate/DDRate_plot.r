library('ggplot2')
library('gridExtra')

time=c(1968.5, 1969.5,1970.5,1971.5,1972.5,1973.5,1974.5,1975.5,1976.5,1977.5,1978.5,1979.5,1980.5,1981.5,1982.5,1983.5,1984.5,1985.5,1986.5,1987.5,1988.5,1989.5,1990.5,1991.5,1992.5,1993.5,1994.5,1995.5,1996.5,1997.5,1998.5,1999.5)
net_diversity=c(1.0, 2.0,5.0,8.0,13.0,14.0,16.5,20.0,25.0,36.0,52.5,84.5,145.0,266.5,455.5,758.5,1130.0,1525.5,1937.0,2517.0,3081.5,3688.0,4345.5,5063.0,5889.5,6689.5,7471.5,8269.5,9044.0,9883.5,10914.0,12074.5)
emp_birth=c(NA, 0.5,0.6,0.375,0.38461538461538464,0.07142857142857142,0.18181818181818182,0.2,0.2,0.3055555555555556,0.3238095238095238,0.41420118343195267,0.4689655172413793,0.5290806754221389,0.5268935236004391,0.5234014502307185,0.46814159292035395,0.429367420517863,0.3939081053175013,0.4028605482717521,0.355346422196982,0.34029284164859,0.330456794384996,0.32016590953979857,0.33041854147211136,0.31123402346961654,0.28548484240112426,0.27474454320091907,0.25375939849624063,0.23534173116810847,0.2278724573941726,0.21955360470412855)
emp_death=c(NA, 0.0,0.0,0.0,0.0,0.0,0.06060606060606061,0.0,0.0,0.0,0.01904761904761905,0.05917159763313609,0.06896551724137931,0.10881801125703565,0.1602634467618002,0.15161502966381016,0.17699115044247787,0.20911176663389053,0.1982447083118224,0.19229241160111243,0.18724647087457408,0.19522776572668113,0.19261304798066967,0.19158601619593127,0.2154682061295526,0.19358696464608716,0.18831559927725355,0.1863474212467501,0.16585581601061478,0.14903627257550464,0.1319406267179769,0.1276243322704874)
birth_rate=c(0.5358958000236308, 0.4832384982170693,0.40372909973590704,0.3579693680928363,0.3067757862667026,0.2991285489707252,0.2790050142438958,0.2606043310376542,0.25481460882582824,0.2670169663179971,0.3300671144762468,0.4235848446374238,0.5009781562327041,0.529590378921601,0.522026751174711,0.493059904340948,0.4634190837423378,0.4382795378546527,0.4173702921263556,0.3929748531059767,0.3730997419542647,0.35560902141818473,0.3391661391960802,0.3228300191408332,0.3060754098592907,0.2914863024444249,0.27850577176777974,0.26656020955611864,0.2559304582505522,0.2449986460030167,0.23271247590391658,0.22034589895041454)
birth_minHPD=c(0.461522018984, 0.408911455101,0.299287569705,0.254557157341,0.19226057812,0.18624480549699998,0.162243762147,0.15175242931,0.160112325129,0.179492732509,0.222416532751,0.33244925136500003,0.433458594639,0.48641087531099997,0.49452457308700004,0.471101529843,0.447418680822,0.42461917345899997,0.40662091547,0.385213629158,0.366995048957,0.349909050717,0.333461778016,0.317716027638,0.301505117284,0.287571436531,0.274625501025,0.262699617162,0.252347792513,0.241502103871,0.228322104351,0.215146726122)
birth_maxHPD=c(0.618736834925, 0.5736529199970001,0.487512425157,0.460939163601,0.413724351586,0.407368494747,0.38589753634900004,0.365405927783,0.346415025044,0.36237841468000004,0.437418360926,0.5329028343500001,0.570101614627,0.572077296326,0.5519332015339999,0.51635949654,0.481067811355,0.45107695919699997,0.427621117525,0.401990698164,0.381194645261,0.362497174234,0.344827285759,0.328163337103,0.31099785320900003,0.296299501231,0.282596514387,0.269968428443,0.25944015106699997,0.249000623692,0.237002053921,0.226099903037)
death_rate=c(0.16888056493906148, 0.1688807365230632,0.16888512576149223,0.16890550543610278,0.16903005615639694,0.16906599134920008,0.16920344618418012,0.1693540691817523,0.16932971878611197,0.16919594461422027,0.16895490382938078,0.16888439002039812,0.168880660481168,0.1688805666107959,0.16888056338977542,0.1688805956045785,0.16888070259329183,0.1688809525206784,0.1688814251753054,0.16888265411086087,0.1688847635739284,0.16888820807695293,0.1688938337004587,0.1689032843257858,0.16891961706046074,0.16894267013574826,0.16897386551170238,0.16901562755772315,0.16906759862638915,0.1691410746212708,0.16925708981810014,0.16942379022136836)
death_minHPD=c(0.16619005257000002, 0.16619005460300001,0.166190112709,0.166173543389,0.166191943116,0.166066593987,0.16638723897500002,0.166299598072,0.16609717811,0.16674392300000002,0.166147507807,0.166190218656,0.166190063999,0.16619005565199998,0.166190056925,0.16619007037,0.166190120503,0.166190249929,0.166190511723,0.16619122978700002,0.16628646386499998,0.166292959982,0.16629895701199998,0.166301844608,0.166234878678,0.16625762808800001,0.1662695668,0.166491708431,0.16654712386,0.166594547962,0.166813514306,0.16700507719399998)
death_maxHPD=c(0.171481539509, 0.171481557681,0.17148214143100002,0.171449435471,0.17158721135000002,0.171576366226,0.17224833689,0.17240968083799998,0.172023771188,0.172305028483,0.171485072779,0.171481764114,0.17148155746100002,0.17148154431499998,0.171481546406,0.171481569925,0.171481659612,0.171481899294,0.17148240042500001,0.171483822642,0.171579535121,0.171584577824,0.171592557948,0.17160550033500002,0.171549541698,0.171565056714,0.17158551367,0.17181145763099998,0.17184614973499998,0.171910637364,0.17211332366999998,0.17231835640299997)
niche=c(153.81998351970165, 153.82530401133204,153.84059681425256,153.88621759840066,154.02829753701786,154.49300900097407,156.09886457966113,161.99927252297562,185.24527375313045,284.9130101875026,773.5395134738071,3651.585661386354,14572.356202132132,33726.46773804045,48745.049502945694,55086.16270126435,57051.08564326301,57606.84872070284,57764.0796583724,57809.93452445893,57823.836518639386,57828.22115545176,57829.65662489965,57830.14277283921,57830.31243192861,57830.37320827494,57830.39547511213,57830.40379136645,57830.40694859082,57830.408164035965,57830.40863755248,57830.40882391602)
niche_minHPD=c(42.8430575523, 42.8468540411,42.8606310211,42.9106259039,43.09205031810001,43.5107553371,36.0017517531,48.948389853500004,62.228279980100005,107.60558163200001,185.81150662299999,429.721242282,4022.82983516,14213.5357604,30547.1104528,37670.6465417,39845.2964509,39427.3329726,38244.5848096,39953.63969709999,39953.6404125,39953.64046730001,39953.640471599996,39953.640471900006,39953.640471900006,39953.640471900006,39953.640471900006,39953.640471900006,39953.640471900006,39953.640471900006,39953.640471900006,39953.640471900006)
niche_maxHPD=c(360.649373799, 360.649394013,360.64951824400003,360.650281727,360.654973859,360.683810224,350.547735216,358.018203751,371.66367509599996,554.4831693919999,1636.35934707,7900.14504724,36550.1386318,53452.3269823,69160.0802875,74304.51112060001,78827.6887687,79646.87780560002,78696.9677661,80493.6172173,80502.7298823,80504.7329118,80505.17314410002,80505.26989750001,80505.29116169999,80505.295835,80505.2968621,80505.29708789999,80505.2971375,80505.2971484,80505.2971508,80505.29715130001)

rates.dat<-data.frame(time,net_diversity,emp_birth,emp_death,birth_rate,birth_minHPD,birth_maxHPD,death_rate,death_minHPD,death_maxHPD,niche,niche_minHPD,niche_maxHPD)

rate_plot<-ggplot(rates.dat, aes(time,birth_rate)) +
    geom_line(size=.7,col='blue') +
    geom_line(aes(time,death_rate),col='red',size=.7) +
     scale_color_manual(values = c('blue','red')) +
    scale_x_continuous(breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,5),minor_breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,1)) +
    scale_y_continuous(breaks=seq(0.0,0.6000000000000001,.1),limits = c(0.0,0.6000000000000001)) + 
    geom_ribbon(aes_string(ymin=birth_minHPD,ymax=birth_maxHPD,fill=shQuote('red')),alpha=.2,col=NA)+ 
    geom_ribbon(aes_string(ymin=death_minHPD,ymax=death_maxHPD,fill=shQuote('blue')),alpha=.2,col=NA)+
    geom_line(aes(time,emp_birth,col='eb'),size=.5,linetype = 'dashed')+
    geom_line(aes(time,emp_death,col='ed'),size=.5,linetype = 'dashed')+
    theme(legend.position = 'none')+
    labs(x='Time',y='Rates')


div_plot<-ggplot(rates.dat,aes(time,net_diversity))+
      geom_line(aes(time,net_diversity,col='Net Diversity'),col='dark green',size=.5,linetype = 'dashed')+
      geom_line(aes(time,niche,col='Carrying Capacity'),size=.5) +
    scale_x_continuous(breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,5),minor_breaks=seq(time[1]-time[1]%%-5,time[length(time)]-time[length(time)]%%-5,1)) +
      geom_ribbon(aes(ymin=niche_minHPD,ymax=niche_maxHPD,fill='Carrying Capacity'),alpha=.30,col=NA) +
      theme(legend.position = 'none')+
      labs(x='Time',y='Number of Lineages')
fig<-grid.arrange(rate_plot,div_plot,nrow = 2,ncol=1)
ggsave(file='example_data/metal_bands/single_run/DD_Rate/DDRate_plot.pdf', plot=fig)
